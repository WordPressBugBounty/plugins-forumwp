(()=>{"use strict";var e={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return e.d(t,{a:t}),t},d:(o,t)=>{for(var a in t)e.o(t,a)&&!e.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:t[a]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)};const o=window.wp.blocks,t=window.wp.components,a=window.wp.serverSideRender;var l=e.n(a);const p=window.wp.blockEditor,r=window.wp.element,n=window.wp.data,s=window.ReactJSXRuntime;(0,o.registerBlockType)("fmwp-block/fmwp-topics-list",{edit:function(e){const o=(0,p.useBlockProps)(),{attributes:a,setAttributes:i}=e,{search:u,new_topic:w,show_forum:c,tag:_,status:d,type:f,order:m}=a,b=(0,n.useSelect)((e=>{const{getEntityRecords:o}=e("core");return o("taxonomy","fmwp_topic_tag")||[]}),[]),h=((0,r.useMemo)((()=>{let e="[fmwp_topics_list";return e+=` search="${u?1:0}"`,e+=` new_topic="${w?1:0}"`,e+=` show_forum="${c?1:0}"`,_&&(e+=` tag="${_}"`),d&&(e+=` status="${d}"`),f&&(e+=` type="${f}"`),e+=` order="${m||FMWP().options().get("default_topics_order")}"`,e+="]",console.log(e),e}),[u,w,c,_,d,f,m]),(0,r.useCallback)((e=>i({search:e})),[i])),v=(0,r.useCallback)((e=>i({new_topic:e})),[i]),g=(0,r.useCallback)((e=>i({show_forum:e})),[i]),k=(0,r.useCallback)((e=>i({tag:e})),[i]),y=(0,r.useCallback)((e=>i({status:e})),[i]),j=(0,r.useCallback)((e=>i({type:e})),[i]),C=(0,r.useCallback)((e=>i({order:e})),[i]);return(0,s.jsxs)("div",{...o,children:[(0,s.jsx)(l(),{block:"fmwp-block/fmwp-topics-list",attributes:a}),(0,s.jsx)(p.InspectorControls,{children:(0,s.jsxs)(t.PanelBody,{title:wp.i18n.__("Topics List Settings","forumwp"),children:[(0,s.jsx)(t.ToggleControl,{label:wp.i18n.__("Enable Search?","forumwp"),checked:u,onChange:h}),(0,s.jsx)(t.ToggleControl,{label:wp.i18n.__("Enable New Topic?","forumwp"),checked:w,onChange:v}),(0,s.jsx)(t.ToggleControl,{label:wp.i18n.__("Show Forum?","forumwp"),checked:c,onChange:g}),(0,s.jsx)(t.SelectControl,{label:wp.i18n.__("Tag","forumwp"),value:_,options:[{label:wp.i18n.__("Select a Tag","forumwp"),value:""},...b.map((e=>({label:e.name,value:e.id})))],onChange:k}),(0,s.jsx)(t.SelectControl,{label:wp.i18n.__("Status","forumwp"),value:d,options:[{value:"",label:wp.i18n.__("Select a status","forumwp")},{value:"open",label:wp.i18n.__("Published","forumwp")},{value:"pending",label:wp.i18n.__("Pending","forumwp")},{value:"trash",label:wp.i18n.__("Trash","forumwp")},{value:"spam",label:wp.i18n.__("Spam","forumwp")},{value:"locked",label:wp.i18n.__("Locked","forumwp")}],onChange:y}),(0,s.jsx)(t.SelectControl,{label:wp.i18n.__("Type","forumwp"),value:f,options:[{value:"",label:wp.i18n.__("Select a type","forumwp")},{value:"normal",label:wp.i18n.__("Normal topics","forumwp")},{value:"pinned",label:wp.i18n.__("Pinned topics","forumwp")},{value:"announcement",label:wp.i18n.__("Announcement topics","forumwp")},{value:"global",label:wp.i18n.__("Global topics","forumwp")}],onChange:j}),(0,s.jsx)(t.SelectControl,{label:wp.i18n.__("Order","forumwp"),value:m||FMWP().options().get("default_topics_order"),options:[{value:"date_desc",label:wp.i18n.__("Newest to Oldest","forumwp")},{value:"date_asc",label:wp.i18n.__("Oldest to Newest","forumwp")},{value:"update_desc",label:wp.i18n.__("Recently updated","forumwp")},{value:"views_desc",label:wp.i18n.__("Most views","forumwp")},{value:"replies_desc",label:wp.i18n.__("Most replies","forumwp")},{value:"likes_desc",label:wp.i18n.__("Most likes (Likes module)","forumwp")},{value:"votes_desc",label:wp.i18n.__("Most votes (Votes module)","forumwp")}],onChange:C})]})})]})},save:()=>null}),jQuery(window).on("load",(function(){new MutationObserver((e=>{e.forEach((e=>{jQuery(e.addedNodes).find(".fmwp-archive-topics-wrapper").each((function(){jQuery(".fmwp-archive-topics-wrapper").each((function(){var e=jQuery(this).find(".fmwp-topics-sort:visible").val();fmwp_get_topics(jQuery(this).find(".fmwp-topics-wrapper"),{page:1,order:e})}))}))}))})).observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0})})),wp.hooks.addAction("fmwp_topics_load_finish","fmwp_topics_load_finish_block",(()=>{const e=document.querySelector(".fmwp-archive-topics-wrapper");if(e){e.addEventListener("click",(o=>{o.target!==e&&(o.preventDefault(),o.stopPropagation())}));let o=jQuery(".fmwp-topics-wrapper");"no"===o.attr("data-show_forum")?o.find(".fmwp-topic-forum").remove():o.find(".fmwp-topic-row").each((function(){let e=jQuery(this).attr("data-forum"),o=jQuery(this).attr("data-forum_url");0===jQuery(this).find(".fmwp-topic-forum").length&&jQuery(this).find(".fmwp-topic-tags-wrapper").after('<span class="fmwp-topic-forum"><strong>Forum:</strong> <a href="'+o+'">'+e+"</a></span>")}))}}))})();