jQuery(document).ready(function(r){var i,e,o;r(document.body).on("click","#fmwp-topic-popup-preview-action",function(){var p=r(this).parents("#fmwp-topic-popup-editors");p.hasClass("fmwp-topic-popup-preview-hidden")?(p.removeClass("fmwp-topic-popup-preview-hidden"),r(this).html(r(this).data("hide_label")),r("#fmwptopiccontent-preview").html(r("#fmwptopiccontent").val())):(p.addClass("fmwp-topic-popup-preview-hidden"),r(this).html(r(this).data("show_label"))),fmwp_resize_popup()}),r(document.body).on("click",".fmwp-topic-popup-discard",function(){var t;fmwp_is_busy("topic_popup")||(t=r(this).parents("#fmwp-topic-popup-wrapper")).hide(1,function(){t.find("form")[0].reset(),r("#fmwptopiccontent").val(""),r("#fmwptopiccontent-preview").html(""),t.removeClass("fmwp-fullsize");var p=t.find("#fmwp-topic-popup-preview-action");p.html(p.data("hide_label")),t.find("#fmwp-topic-popup-editors").removeClass("fmwp-topic-popup-preview-hidden")})}),r(document.body).on("click",".fmwp-topic-popup-submit",function(p){var s,n,t,i,e,a,c,f;p.preventDefault(),fmwp_is_busy("topic_popup")||((s=r(this)).siblings(".fmwp-ajax-loading").css("visibility","visible").show(),s.css("visibility","hidden"),n=r("#fmwp-topic-popup-wrapper"),p=r(this).parents("form"),t=p.serializeArray(),i="undefined"!=typeof tinymce?tinyMCE.get("fmwptopiccontent").getContent({format:"raw"}):r("#fmwptopiccontent").val(),e={},r.each(t,function(p){"fmwp-topic[content]"===t[p].name?e[t[p].name]=i:e[t[p].name]=t[p].value}),a=e["fmwp-topic[forum_id]"],c=e["fmwp-topic[topic_id]"],f="edit-topic"===e["fmwp-action"]?"fmwp_edit_topic":"fmwp_create_topic",p.find("input, #wp-fmwptopiccontent-wrap").removeClass("fmwp-error-field").removeAttr("title"),fmwp_set_busy("topic_popup",!0),wp.ajax.send(f,{data:e,success:function(t){if("fmwp_edit_topic"==f){var i=n.data("fmwp-target"),p=t,e=c;"forum-page"===i||"topics-page"===i?(o=wp.template("fmwp-topic")(p),r(".fmwp-topics-wrapper").find('.fmwp-topic-row[data-topic_id="'+e+'"]').replaceWith(o)):"topic-page"===i&&(r(".fmwp-topic-title").html(p.title),r(".fmwp-topic-data-content").html(p.content),r(".fmwp-topic-stats.fmwp-tags-stats").length&&(e=wp.template("fmwp-topic-tags-line")(p.tags),r(".fmwp-topic-stats.fmwp-tags-stats").html(e)),wp.hooks.doAction("fmwp_after_edit_topic",p))}else{var o=t,i=a;o=wp.template("fmwp-topic")(o);let p=(i=r('.fmwp-topics-wrapper[data-fmwp_forum_id="'+i+'"]')).find(".fmwp-forum-sort:visible").val();i.length||(i=r(".fmwp-archive-topics-wrapper .fmwp-topics-wrapper"),p=r(".fmwp-archive-topics-wrapper").find(".fmwp-topics-sort:visible").val()),"date_desc"===p?i.find(".fmwp-topic-row.fmwp-topic-announcement:last").length?i.find(".fmwp-topic-row.fmwp-topic-announcement:last").after(o):i.find(".fmwp-topic-row.fmwp-topic-pinned:last").length?i.find(".fmwp-topic-row.fmwp-topic-pinned:last").after(o):i.find(".fmwp-topic-row.fmwp-topic-global:last").length?i.find(".fmwp-topic-row.fmwp-topic-global:last").after(o):i.prepend(o):"date_asc"===p&&i.append(o),i.find(".fmwp-forum-no-topics").length&&i.find(".fmwp-forum-no-topics").remove(),i.find(".fmwp-topic-actions-dropdown").length?i.siblings(".fmwp-topics-wrapper-heading").removeClass("fmwp-no-actions-heading"):i.siblings(".fmwp-topics-wrapper-heading").addClass("fmwp-no-actions-heading")}fmwp_set_busy("topic_popup",!1),r(".fmwp-topic-popup-discard:first").trigger("click"),s.siblings(".fmwp-ajax-loading").css("visibility","hidden").hide(),s.css("visibility","visible");e=r('.fmwp-forum-head[data-fmwp_forum_id="'+a+'"]');(e.length?e.find(".fmwp-forum-sort:visible"):r(".fmwp-archive-topics-wrapper").find(".fmwp-topics-sort:visible")).trigger("change")},error:function(t){t.errors?r.each(t.errors,function(p){jQuery("#"+t.errors[p].field).addClass("fmwp-error-field").attr("title",t.errors[p].message)}):(console.log(t),r(this).fmwp_notice({message:t,type:"error"})),fmwp_set_busy("topic_popup",!1),s.siblings(".fmwp-ajax-loading").css("visibility","hidden").hide(),s.css("visibility","visible")}}))}),r(document.body).on("keyup","#fmwptopiccontent",(i=function(p){var t;r(this).parents("#fmwp-topic-popup-editors").hasClass("fmwp-topic-popup-preview-hidden")||fmwp_is_busy("topic_popup_preview")||(t=fmwp_stringToHash(this.value))!=r(this).data("content-hash")&&(r(this).data("content-hash",t),fmwp_set_busy("topic_popup_preview",!0),wp.ajax.send("fmwp_topic_build_preview",{data:{content:this.value,nonce:fmwp_front_data.nonce},success:function(p){r("#fmwptopiccontent-preview").html(p),fmwp_set_busy("topic_popup_preview",!1)},error:function(p){console.log(p),r(this).fmwp_notice({message:p,type:"error"}),fmwp_set_busy("topic_popup_preview",!1)}}))},e=1e3,o=0,function(){var p=this,t=arguments;clearTimeout(o),o=setTimeout(function(){i.apply(p,t)},e||0)}))});