jQuery(document).ready(function(c){var t,r,i;c(document.body).on("click","#fmwp-reply-popup-preview-action",function(){var p=c(this).parents("#fmwp-reply-popup-editors");p.hasClass("fmwp-reply-popup-preview-hidden")?(p.removeClass("fmwp-reply-popup-preview-hidden"),c(this).html(c(this).data("hide_label")),c("#fmwpreplycontent-preview").html(c("#fmwpreplycontent").val())):(p.addClass("fmwp-reply-popup-preview-hidden"),c(this).html(c(this).data("show_label"))),fmwp_resize_popup()}),c(document.body).on("click",".fmwp-reply-popup-discard",function(){var e;fmwp_is_busy("reply_popup")||(e=c(this).parents("#fmwp-reply-popup-wrapper")).hide(1,function(){e.find("form")[0].reset(),c("#fmwpreplycontent").val(""),c("#fmwpreplycontent-preview").html(""),e.removeClass("fmwp-fullsize");var p=e.find("#fmwp-reply-popup-preview-action");p.html(p.data("hide_label")),e.find("#fmwp-reply-popup-editors").removeClass("fmwp-reply-popup-preview-hidden"),e.trigger("fmwp_reply_popup_discard")})}),c(document.body).on("click",".fmwp-reply-popup-submit",function(p){var m,e,t,r,f,w,d;p.preventDefault(),fmwp_is_busy("reply_popup")||((m=c(this)).siblings(".fmwp-ajax-loading").css("visibility","visible").show(),m.css("visibility","hidden"),p=c(this).parents("form"),e=p.serializeArray(),t="undefined"!=typeof tinymce?tinyMCE.get("fmwpreplycontent").getContent({format:"raw"}):c("#fmwpreplycontent").val(),r={},c.each(e,function(p){"fmwp-reply[content]"===e[p].name?r[e[p].name]=t:r[e[p].name]=e[p].value}),f=r["fmwp-reply[topic_id]"],w=r["fmwp-reply[reply_id]"],d="edit-reply"===r["fmwp-action"]?"fmwp_edit_reply":"fmwp_create_reply",p.find("input, #wp-fmwpreplycontent-wrap").removeClass("fmwp-error-field").removeAttr("title"),fmwp_set_busy("reply_popup",!0),wp.ajax.send(d,{data:r,success:function(p){var e,t,r,i,l,s,a,n,o;"fmwp_edit_reply"==d?(i=f,t=w,(0===(e=p).post_parent?(l=wp.template("fmwp-parent-reply"),e.sub_template=!1,r=l(e),c('.fmwp-topic-wrapper[data-fmwp_topic_id="'+i+'"]')):(l=wp.template("fmwp-parent-reply"),e.sub_template=!0,r=l(e),c('.fmwp-topic-wrapper[data-fmwp_topic_id="'+i+'"]').find('.fmwp-reply-row[data-reply_id="'+e.post_parent+'"]').find("> .fmwp-reply-children"))).find('.fmwp-reply-row[data-reply_id="'+t+'"]').replaceWith(r),fmwp_set_busy("reply_popup",!1),c(".fmwp-reply-popup-discard:first").trigger("click")):(l=f,0===(i=p).post_parent?(o=wp.template("fmwp-parent-reply"),i.sub_template=!1,n=o(i),"date_desc"===(a=(a=(s=c('.fmwp-topic-wrapper[data-fmwp_topic_id="'+l+'"]')).parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-sort:visible")).length?a.val():s.data("order"))?s.prepend(n):"date_asc"===a&&s.append(n),s.find(".fmwp-topic-no-replies").length&&s.find(".fmwp-topic-no-replies").remove()):(o=wp.template("fmwp-parent-reply"),i.sub_template=!0,n=o(i),o=(s=c('.fmwp-topic-wrapper[data-fmwp_topic_id="'+l+'"]')).parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-sort:visible"),a=o.length?o.val():s.data("order"),l=s.find('.fmwp-reply-row[data-reply_id="'+i.post_parent+'"]').find("> .fmwp-reply-children"),"date_desc"===a?l.prepend(n):"date_asc"===a&&l.append(n),i.is_subsub&&(l.siblings(".fmwp-reply-child-connect").show(),(o=s.find('.fmwp-reply-row[data-reply_id="'+i.post_parent+'"]').closest(".fmwp-reply-row:not(.fmwp-child-reply)").find("> .fmwp-reply-base .fmwp-replies-count")).html(parseInt(o.html())+1)),(n=s.find('.fmwp-reply-row[data-reply_id="'+i.post_parent+'"] > .fmwp-reply-base').find(".fmwp-replies-count")).html(parseInt(n.html())+1),l=wp.template("fmwp-subreplies-list")(i.parent_data),s.find('.fmwp-reply-row[data-reply_id="'+i.post_parent+'"] > .fmwp-reply-base').find(".fmwp-reply-left-panel").html(l)),fmwp_set_busy("reply_popup",!1),c(".fmwp-reply-popup-discard:first").trigger("click"),(o=c("#fmwp-replies-total")).html(parseInt(o.html())+1),fmwp_change_topic_sorting_visibility(s)),fmwp_embed_resize_async(),m.siblings(".fmwp-ajax-loading").css("visibility","hidden").hide(),m.css("visibility","visible")},error:function(e){e.errors?c.each(e.errors,function(p){jQuery("#"+e.errors[p].field).addClass("fmwp-error-field").attr("title",e.errors[p].message)}):(console.log(e),c(this).fmwp_notice({message:e,type:"error"})),fmwp_set_busy("reply_popup",!1),m.siblings(".fmwp-ajax-loading").css("visibility","hidden").hide(),m.css("visibility","visible")}}))}),c(document.body).on("keyup","#fmwpreplycontent",(t=function(p){var e;c(this).parents("#fmwp-reply-popup-editors").hasClass("fmwp-reply-popup-preview-hidden")||fmwp_is_busy("reply_popup_preview")||(e=fmwp_stringToHash(this.value))!=c(this).data("content-hash")&&(c(this).data("content-hash",e),fmwp_set_busy("reply_popup_preview",!0),wp.ajax.send("fmwp_reply_build_preview",{data:{content:this.value,nonce:fmwp_front_data.nonce},success:function(p){c("#fmwpreplycontent-preview").is(":visible")?c("#fmwpreplycontent-preview").html(p):c("#fmwpreplycontent-preview").html(""),fmwp_set_busy("reply_popup_preview",!1)},error:function(p){console.log(p),c(this).fmwp_notice({message:p,type:"error"}),fmwp_set_busy("reply_popup_preview",!1)}}))},r=1e3,i=0,function(){var p=this,e=arguments;clearTimeout(i),i=setTimeout(function(){t.apply(p,e)},r||0)}))});