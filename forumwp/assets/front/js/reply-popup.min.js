jQuery(document).ready(function(y){var t,r,i;y(document.body).on("click","#fmwp-reply-popup-preview-action",function(){var p=y(this).parents("#fmwp-reply-popup-editors");p.hasClass("fmwp-reply-popup-preview-hidden")?(p.removeClass("fmwp-reply-popup-preview-hidden"),y(this).html(y(this).data("hide_label")),y("#fmwpreplycontent-preview").html(y("#fmwpreplycontent").val())):(p.addClass("fmwp-reply-popup-preview-hidden"),y(this).html(y(this).data("show_label"))),fmwp_resize_popup()}),y(document.body).on("click",".fmwp-reply-popup-discard",function(){var e;fmwp_is_busy("reply_popup")||(e=y(this).parents("#fmwp-reply-popup-wrapper")).hide(1,function(){e.find("form")[0].reset(),y("#fmwpreplycontent").val(""),y("#fmwpreplycontent-preview").html(""),e.removeClass("fmwp-fullsize");var p=e.find("#fmwp-reply-popup-preview-action");p.html(p.data("hide_label")),e.find("#fmwp-reply-popup-editors").removeClass("fmwp-reply-popup-preview-hidden"),e.trigger("fmwp_reply_popup_discard")})}),y(document.body).on("click",".fmwp-reply-popup-submit",function(p){var m,e,t,r,f,w,d;p.preventDefault(),fmwp_is_busy("reply_popup")||((m=y(this)).siblings(".fmwp-ajax-loading").css("visibility","visible").show(),m.css("visibility","hidden"),p=y(this).parents("form"),e=p.serializeArray(),t=tinyMCE.get("fmwpreplycontent"),r={},y.each(e,function(p){"fmwp-reply[content]"===e[p].name?r[e[p].name]=t.getContent({format:"raw"}):r[e[p].name]=e[p].value}),f=r["fmwp-reply[topic_id]"],w=r["fmwp-reply[reply_id]"],d="edit-reply"===r["fmwp-action"]?"fmwp_edit_reply":"fmwp_create_reply",p.find("input, #wp-fmwpreplycontent-wrap").removeClass("fmwp-error-field").removeAttr("title"),fmwp_set_busy("reply_popup",!0),wp.ajax.send(d,{data:r,success:function(p){var e,t,r,i,s,l,a,n,o;"fmwp_edit_reply"==d?(i=f,t=w,(0===(e=p).post_parent?(s=wp.template("fmwp-parent-reply"),e.sub_template=!1,r=s(e),y('.fmwp-topic-wrapper[data-fmwp_topic_id="'+i+'"]')):(s=wp.template("fmwp-parent-reply"),e.sub_template=!0,r=s(e),y('.fmwp-topic-wrapper[data-fmwp_topic_id="'+i+'"]').find('.fmwp-reply-row[data-reply_id="'+e.post_parent+'"]').find("> .fmwp-reply-children"))).find('.fmwp-reply-row[data-reply_id="'+t+'"]').replaceWith(r),fmwp_set_busy("reply_popup",!1),y(".fmwp-reply-popup-discard:first").trigger("click")):(s=f,0===(i=p).post_parent?(o=wp.template("fmwp-parent-reply"),i.sub_template=!1,n=o(i),l=y('.fmwp-topic-wrapper[data-fmwp_topic_id="'+s+'"]'),"date_desc"===(a=l.data("order"))?l.prepend(n):"date_asc"===a&&l.append(n),l.find(".fmwp-topic-no-replies").length&&l.find(".fmwp-topic-no-replies").remove()):(o=wp.template("fmwp-parent-reply"),i.sub_template=!0,n=o(i),l=y('.fmwp-topic-wrapper[data-fmwp_topic_id="'+s+'"]'),a=l.data("order"),o=l.find('.fmwp-reply-row[data-reply_id="'+i.post_parent+'"]').find("> .fmwp-reply-children"),"date_desc"===a?o.prepend(n):"date_asc"===a&&o.append(n),i.is_subsub&&(o.siblings(".fmwp-reply-child-connect").show(),(s=l.find('.fmwp-reply-row[data-reply_id="'+i.post_parent+'"]').closest(".fmwp-reply-row:not(.fmwp-child-reply)").find("> .fmwp-reply-base .fmwp-replies-count")).html(parseInt(s.html())+1)),(a=l.find('.fmwp-reply-row[data-reply_id="'+i.post_parent+'"] > .fmwp-reply-base').find(".fmwp-replies-count")).html(parseInt(a.html())+1),n=wp.template("fmwp-subreplies-list")(i.parent_data),l.find('.fmwp-reply-row[data-reply_id="'+i.post_parent+'"] > .fmwp-reply-base').find(".fmwp-reply-left-panel").html(n)),fmwp_set_busy("reply_popup",!1),y(".fmwp-reply-popup-discard:first").trigger("click"),(o=y("#fmwp-replies-total")).html(parseInt(o.html())+1),fmwp_change_topic_sorting_visibility(l)),fmwp_embed_resize_async(),m.siblings(".fmwp-ajax-loading").css("visibility","hidden"),m.css("visibility","visible")},error:function(e){e.errors?y.each(e.errors,function(p){jQuery("#"+e.errors[p].field).addClass("fmwp-error-field").attr("title",e.errors[p].message)}):(console.log(e),y(this).fmwp_notice({message:e,type:"error"})),fmwp_set_busy("reply_popup",!1),m.siblings(".fmwp-ajax-loading").css("visibility","hidden"),m.css("visibility","visible")}}))}),y(document.body).on("keyup","#fmwpreplycontent",(t=function(p){var e;y(this).parents("#fmwp-reply-popup-editors").hasClass("fmwp-reply-popup-preview-hidden")||fmwp_is_busy("reply_popup_preview")||(e=fmwp_stringToHash(this.value))!=y(this).data("content-hash")&&(y(this).data("content-hash",e),fmwp_set_busy("reply_popup_preview",!0),wp.ajax.send("fmwp_reply_build_preview",{data:{content:this.value,nonce:fmwp_front_data.nonce},success:function(p){y("#fmwpreplycontent-preview").is(":visible")?y("#fmwpreplycontent-preview").html(p):y("#fmwpreplycontent-preview").html(""),fmwp_set_busy("reply_popup_preview",!1)},error:function(p){console.log(p),y(this).fmwp_notice({message:p,type:"error"}),fmwp_set_busy("reply_popup_preview",!1)}}))},r=1e3,i=0,function(){var p=this,e=arguments;clearTimeout(i),i=setTimeout(function(){t.apply(p,e)},r||0)}))});