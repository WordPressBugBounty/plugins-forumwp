var fmwp_forums_page=2,fmwp_no_forums_search_template='<span class="fmwp-no-forums">'+wp.i18n.__("No results found.","forumwp")+"</span>";function fmwp_get_forums(r,a){fmwp_set_busy("forums_list",!0);var s={page:a.page,order:a.order,category:r.data("category_id"),with_sub:r.data("with_subcategories"),nonce:fmwp_front_data.nonce};a.search&&(s.search=a.search),wp.ajax.send("fmwp_get_forums",{data:s,success:function(s){s.forums.length?(s.actions?r.siblings(".fmwp-forums-wrapper-heading").removeClass("fmwp-no-actions-heading"):1===a.page&&r.siblings(".fmwp-forums-wrapper-heading").addClass("fmwp-no-actions-heading"),s=wp.template("fmwp-forums-list")({forums:s.forums}),r.find(".fmwp-load-more").remove(),1===a.page?r.html(s+'<span class="fmwp-load-more"></span>'):r.append(s+'<span class="fmwp-load-more"></span>'),fmwp_forums_page=parseInt(a.page)+1):(r.find(".fmwp-load-more").remove(),1===a.page&&(a.search?r.html(fmwp_no_forums_search_template):r.html('<span class="fmwp-no-forums">'+r.data("no-forums-text")+"</span>"),r.siblings(".fmwp-forums-wrapper-heading").addClass("fmwp-no-actions-heading"))),fmwp_set_busy("forums_list",!1),wp.hooks.doAction("fmwp_forums_load_finish")},error:function(s){console.log(s),fmwp_set_busy("forums_list",!1)}})}jQuery(document).ready(function(o){o(".fmwp-forums-wrapper").each(function(){var s=o(this).parents(".fmwp-archive-forums-wrapper").data("order");fmwp_get_forums(o(this),{page:1,order:s})}),o(window).on("scroll",function(){var s,r,a,e={allow:!0,reallow:function(){e.allow=!0},delay:400};!fmwp_is_busy("forums_list")&&e.allow&&(e.allow=!1,s=o(".fmwp-forums-wrapper").parents(".fmwp-archive-forums-wrapper").find(".fmwp-forums-search-line").val(),r=o(".fmwp-forums-wrapper").parents(".fmwp-archive-forums-wrapper").data("order"),(a=o(".fmwp-forums-wrapper .fmwp-load-more")).length)&&(setTimeout(e.reallow,e.delay),a.offset().top-o(window).scrollTop()<1e3)&&fmwp_get_forums(o(".fmwp-forums-wrapper"),{page:fmwp_forums_page,order:r,search:s})}),o(document.body).on("click",".fmwp-search-forum",function(s){if(s.preventDefault(),!fmwp_is_busy("forums_list")){var s=o(this).siblings("label").find(".fmwp-forums-search-line").val(),r=o(this).parents(".fmwp-forums-list-head").data("fmwp_search");if(void 0===r&&""===s||r===s)return!1;r=o(this).parents(".fmwp-archive-forums-wrapper").data("order");o(this).parents(".fmwp-forums-list-head").data("fmwp_search",s),fmwp_forums_page=1,fmwp_get_forums(o(this).parents(".fmwp-forums-list-head").siblings(".fmwp-forums-wrapper"),{page:1,search:s,order:r})}}),o(document.body).on("keypress",".fmwp-forums-search-line",function(s){13===s.which&&o(this).parents("label").siblings(".fmwp-search-forum").trigger("click")})});