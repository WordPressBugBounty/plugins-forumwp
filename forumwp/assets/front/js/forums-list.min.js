var fmwp_forums_page=2,fmwp_no_forums_search_template='<span class="fmwp-no-forums">'+wp.i18n.__("No results found.","forumwp")+"</span>";function fmwp_get_forums(s,a){fmwp_set_busy("forums_list",!0);var r={page:a.page,order:a.order,category:s.data("category_id"),with_sub:s.data("with_subcategories"),nonce:fmwp_front_data.nonce};a.search&&(r.search=a.search),wp.ajax.send("fmwp_get_forums",{data:r,success:function(r){r.forums.length?(r.actions?s.siblings(".fmwp-forums-wrapper-heading").removeClass("fmwp-no-actions-heading"):1===a.page&&s.siblings(".fmwp-forums-wrapper-heading").addClass("fmwp-no-actions-heading"),r=wp.template("fmwp-forums-list")({forums:r.forums}),s.find(".fmwp-load-more").remove(),1===a.page?s.html(r+'<span class="fmwp-load-more"></span>'):s.append(r+'<span class="fmwp-load-more"></span>'),fmwp_forums_page=parseInt(a.page)+1):(s.find(".fmwp-load-more").remove(),1===a.page&&(a.search?s.html(fmwp_no_forums_search_template):s.html('<span class="fmwp-no-forums">'+s.data("no-forums-text")+"</span>"),s.siblings(".fmwp-forums-wrapper-heading").addClass("fmwp-no-actions-heading"))),fmwp_set_busy("forums_list",!1)},error:function(r){console.log(r),fmwp_set_busy("forums_list",!1)}})}jQuery(document).ready(function(o){o(".fmwp-forums-wrapper").each(function(){var r=o(this).parents(".fmwp-archive-forums-wrapper").data("order");fmwp_get_forums(o(this),{page:1,order:r})}),o(window).scroll(function(){var r,s,a,e={allow:!0,reallow:function(){e.allow=!0},delay:400};!fmwp_is_busy("forums_list")&&e.allow&&(e.allow=!1,r=o(".fmwp-forums-wrapper").parents(".fmwp-archive-forums-wrapper").find(".fmwp-forums-search-line").val(),s=o(".fmwp-forums-wrapper").parents(".fmwp-archive-forums-wrapper").data("order"),(a=o(".fmwp-forums-wrapper .fmwp-load-more")).length)&&(setTimeout(e.reallow,e.delay),a.offset().top-o(window).scrollTop()<1e3)&&fmwp_get_forums(o(".fmwp-forums-wrapper"),{page:fmwp_forums_page,order:s,search:r})}),o(document.body).on("click",".fmwp-search-forum",function(r){if(r.preventDefault(),!fmwp_is_busy("forums_list")){var r=o(this).siblings("label").find(".fmwp-forums-search-line").val(),s=o(this).parents(".fmwp-forums-list-head").data("fmwp_search");if(void 0===s&&""===r||s===r)return!1;s=o(this).parents(".fmwp-archive-forums-wrapper").data("order");o(this).parents(".fmwp-forums-list-head").data("fmwp_search",r),fmwp_forums_page=1,fmwp_get_forums(o(this).parents(".fmwp-forums-list-head").siblings(".fmwp-forums-wrapper"),{page:1,search:r,order:s})}}),o(document.body).on("keypress",".fmwp-forums-search-line",function(r){13===r.which&&o(this).parents("label").siblings(".fmwp-search-forum").trigger("click")})});