var fmwp_replies_page=2,fmwp_no_replies_template=fmwp_front_data.can_reply?'<span class="fmwp-topic-no-replies">'+wp.i18n.__('No one has replied to this topic. Be the first and <a href="#" class="fmwp-write-reply fmwp-login-to-action" data-fmwp_popup_title="Login to reply to this topic">leave a reply</a>.',"forumwp")+"</span>":'<span class="fmwp-topic-no-replies">'+wp.i18n.__("No one has replied to this topic.","forumwp")+"</span>",fmwp_no_replies_locked_template='<span class="fmwp-topic-no-replies">'+wp.i18n.__("No one has replied to this topic.","forumwp")+"</span>",fmwp_topic_hash=window.location.hash.substr(1),fmwp_selected_reply=!1,fmwp_delay_reply_loading=!1,fmwp_selected_reply_next_offset=!1;function fmwp_get_replies(l,t){fmwp_set_busy("individual_topic",!0);var e={topic_id:l.data("fmwp_topic_id"),page:t.page,order:t.order,nonce:fmwp_front_data.nonce};fmwp_selected_reply&&1===parseInt(t.page)&&(e.reply_id=fmwp_selected_reply),fmwp_selected_reply_next_offset&&(e.offset=fmwp_selected_reply_next_offset),wp.ajax.send("fmwp_get_replies",{data:e,success:function(e){var p;fmwp_selected_reply||e.length?(p="",p=wp.template("fmwp-replies-list")(fmwp_selected_reply?{replies:e.replies,sub_template:!1}:{replies:e,sub_template:!1}),l.data("order",t.order),l.find(".fmwp-load-more").remove(),1!==t.page||fmwp_selected_reply_next_offset?l.append(p+'<span class="fmwp-load-more"></span>'):l.html(p+'<span class="fmwp-load-more"></span>'),fmwp_replies_page=parseInt(t.page)+1,fmwp_selected_reply_next_offset=!1,fmwp_selected_reply&&e.scroll_to&&(jQuery("#fmwp-reply-"+e.scroll_to).is(":visible")?(fmwp_replies_page=e.next_page,fmwp_selected_reply_next_offset=e.next_offset,jQuery("html").animate({scrollTop:jQuery("#fmwp-reply-"+e.scroll_to).offset().top},1e3,function(){e.scroll_to==fmwp_selected_reply&&jQuery("#fmwp-reply-"+e.scroll_to).addClass("fmwp-focus-reply"),e.expand_child&&jQuery("#fmwp-reply-"+e.scroll_to).find(".fmwp-show-child-replies").length?jQuery("#fmwp-reply-"+e.scroll_to).find(".fmwp-show-child-replies").trigger("click"):fmwp_delay_reply_loading=fmwp_selected_reply=!1})):fmwp_delay_reply_loading=fmwp_selected_reply=!1)):(l.find(".fmwp-load-more").remove(),1!==t.page||fmwp_selected_reply_next_offset?fmwp_selected_reply_next_offset&&(fmwp_selected_reply_next_offset=!1,l.find(".fmwp-load-more").remove()):l.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-locked")||l.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-pending")||l.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-spam")?l.html(fmwp_no_replies_locked_template):l.html(fmwp_no_replies_template)),fmwp_embed_resize_async(),fmwp_set_busy("individual_topic",!1),wp.hooks.doAction("fmwp_replies_load_finish")},error:function(e){console.log(e),jQuery(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}jQuery(document).ready(function(i){fmwp_embed_containers.push(".fmwp-topic-data-content"),fmwp_embed_containers.push(".fmwp-reply-content"),fmwp_topic_hash&&0===fmwp_topic_hash.indexOf("reply")&&(fmwp_selected_reply=parseInt(fmwp_topic_hash.replace("reply-","")),fmwp_delay_reply_loading=!0),i(".fmwp-topic-wrapper").each(function(){let e;var p=i(this).parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-sort:visible");e=p.length?p.val():i(this).data("order"),fmwp_get_replies(i(this),{page:1,order:e})});var e={allow:!0,reallow:function(){e.allow=!0},delay:400};i(window).on("scroll",function(){if(!fmwp_delay_reply_loading&&!fmwp_is_busy("individual_topic")&&e.allow){e.allow=!1;var p=i(".fmwp-topic-wrapper .fmwp-load-more");if(p.length)if(setTimeout(e.reallow,e.delay),p.offset().top-i(window).scrollTop()<1e3){let e;p=p.parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-sort:visible");e=p.length?p.val():i(".fmwp-topic-wrapper").data("order"),fmwp_get_replies(i(".fmwp-topic-wrapper"),{page:fmwp_replies_page,order:e})}}}),i(document.body).on("change",".fmwp-topic-sort",function(e){var p;e.preventDefault(),fmwp_is_busy("individual_topic")||(e=i(this).parents(".fmwp-topic-content").find(".fmwp-topic-wrapper"),p=i(this).val(),e.find(".fmwp-topic-sort").val(p),fmwp_get_replies(e,{page:fmwp_replies_page=1,order:p}))}),i(document.body).on("click",".fmwp-show-child-replies",function(l){if(l.preventDefault(),!fmwp_is_busy("individual_topic")){var t=i(this),r=t.closest(".fmwp-reply-row"),l=r.data("reply_id"),s=r.find(".fmwp-reply-children");if(t.hasClass("fmwp-replies-loaded"))s.is(":visible")?(r.find("> .fmwp-reply-child-connect").hide(),s.slideUp()):(r.find("> .fmwp-reply-child-connect").show(),s.slideDown());else{let e=i(this).parents(".fmwp-topic-content").find(".fmwp-topic-wrapper"),p;var o=i(this).parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-sort:visible"),l={reply_id:l,order:p=o.length?o.val():e.data("order"),nonce:fmwp_front_data.nonce};fmwp_selected_reply&&(l.search_reply=fmwp_selected_reply),fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_get_child_replies",{data:l,success:function(e){var p=wp.template("fmwp-replies-list"),l="",l=p(fmwp_selected_reply?{replies:e.replies,sub_template:!0}:{replies:e,sub_template:!0});s.append(l),r.find("> .fmwp-reply-child-connect").show(),s.slideDown(),fmwp_embed_resize_async(),t.addClass("fmwp-replies-loaded"),fmwp_selected_reply&&e.scroll_to&&(jQuery("#fmwp-reply-"+e.scroll_to).is(":visible")?jQuery("html").animate({scrollTop:jQuery("#fmwp-reply-"+e.scroll_to).offset().top},1e3,function(){e.scroll_to==fmwp_selected_reply&&jQuery("#fmwp-reply-"+e.scroll_to).addClass("fmwp-focus-reply"),e.expand_child?jQuery("#fmwp-reply-"+e.scroll_to).find(".fmwp-show-child-replies").trigger("click"):fmwp_delay_reply_loading=fmwp_selected_reply=!1}):fmwp_delay_reply_loading=fmwp_selected_reply=!1),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),i(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}})});